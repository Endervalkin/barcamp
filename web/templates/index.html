<!DOCTYPE html>
<html>
<head>
  <title>Barcamp Map</title>
  <style>
    body {
      margin: 0;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    #sidebar {
      width: 300px;
      background: #f4f4f4;
      padding: 20px;
      box-shadow: 2px 0 6px rgba(0,0,0,0.1);
      z-index: 10;
    }

    #map-container {
      flex: 1;
      overflow: scroll;
      background: #222;
      position: relative;
    }

    #map {
      transform-origin: top left;
      transition: transform 0.2s ease;
      display: block;
    }

    #controls {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div id="sidebar">
    <h3>Create Character</h3>
    <input type="text" id="playerName" placeholder="Name">
    <button onclick="createPlayer()">Create Player</button>
    <button onclick="endMonth()">End Month</button>
    <div id="status"></div>
  </div>
  <div id="zoomLayer">
  <!-- Map container -->
  <div id="map-container" style="position: relative; width: 100%; height: 100%;">
    <img src="{{ url_for('static', filename='CerroMap2025_nogrid-01.svg') }}" alt="Map" id="map-image"
        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0;">

    <!-- SVG overlay will be injected here -->
    <div id="svg-container" z-index="2">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2686 4096" width="2686" height="4096">
            <!-- Root group for zoom and pan -->
            <g id="zoomLayer">
              <!-- Optional: translate before scaling -->
              <g id="viewport">
                <g id="hexes" fill="none" stroke="black" stroke-width="2">
                  <!-- Dummy hexes in axial grid -->
               
              </g>
            </g>
          </g>
        </svg>
    </div>
  </div>
</div>
  <script>
    fetch('/hex-overlay.svg')
      .then(res => res.text())
      .then(svg => {
        document.getElementById('svg-container').innerHTML = svg;
      });
  </script>


  <script>
    let scale = 1;
    const map = document.getElementById("map-container");
    const container = document.getElementById("map-container");

    // Simple zoom handler
    container.addEventListener("wheel", e => {
      e.preventDefault();
      scale += e.deltaY < 0 ? 0.1 : -0.1;
      scale = Math.max(0.2, Math.min(scale, 3));
      map.style.transform = `scale(${scale})`;
    });

    function createPlayer() {
      const name = document.getElementById("playerName").value;
      fetch("/create_player", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name })
      }).then(res => res.json())
        .then(data => document.getElementById("status").innerText = `Created: ${data.name}`);
    }

    function endMonth() {
      fetch("/end_month", { method: "POST" })
        .then(res => res.json())
        .then(data => document.getElementById("status").innerText = `Month Ended. Income: ${data.trade_income}`);
    }

    
  </script>

  <div id="debug-box" style="
  position: fixed;
  bottom: 10px;
  right: 10px;
  background: rgba(0,0,0,0.8);
  color: #fff;
  font-family: monospace;
  padding: 8px 12px;
  border-radius: 4px;
  z-index: 9999;
  pointer-events: none;
">
  Debug: Waiting for hex click...
</div>
<script src="{{ url_for('static', filename='game.js') }}"></script>
</body>
</html>